ğŸ—½ Times Square NYC-Style VANET Traffic Simulation ï¿½
======================================================================
ğŸ›£ï¸  Created 97 intersections (highway corridor in middle)

ğŸ›£ï¸  HIGHWAY-FOCUSED VANET NETWORK ğŸ›£ï¸
======================================================================
  ğŸ“ Intersections: 97 (city areas only)
  ğŸ›£ï¸  Roads: 350 road segments
  ğŸï¸  LONG HIGHWAY CORRIDOR: 4 express lanes (70 mph)
     - Spans full network width (~3300 pixels)
     - 6 lanes per direction (12 total)
  ğŸš— City streets: 7 rows (35 mph)
  ğŸ¯ Highway exits: 5 on/off ramps
  ğŸš¦ Perimeter highways: 65 mph express ring
======================================================================
Initializing 150 vehicles in city network...
ğŸ—³ï¸  Enabling consensus-based cluster head elections...
   âœ“ Initialized consensus with 5 authority nodes
   âœ“ Authorities: v1, v2, v3, v4, v5
Running city simulation for 120 seconds...
ğŸ—³ï¸  Leader failure detection enabled (co-leader succession)

======================================================================
ğŸ”¬ THREE IMPROVEMENTS ACTIVE:
======================================================================
âœ… Improvement 1: Transparent Trust Calculation
   Formula: trust = 0.5Ã—historical_avg + 0.5Ã—social_trust
   Resources: bandwidth (50-150 Mbps) + processing (1-4 GHz)

âœ… Improvement 2: True Consensus Voting
   Scoring: 60% trust + 40% resource (simplified from 5 metrics)
   Voting: 51% majority required (trust-weighted votes)

âœ… Improvement 3: Sleeper Agent Detection
   Historical: Track trust spikes (>0.3 increase flagged)
   Penalty: 50% trust reduction + election ban
======================================================================

   âš ï¸  PoA Detection: v0 flagged as malicious (trust: 0.20 â†’ 0.14, cluster votes: 2/2)
   âš ï¸  PoA Detection: v16 flagged as malicious (trust: 0.19 â†’ 0.13, cluster votes: 2/2)
   âš ï¸  PoA Detection: v32 flagged as malicious (trust: 0.20 â†’ 0.14, cluster votes: 5/5)
   âš ï¸  PoA Detection: v40 flagged as malicious (trust: 0.20 â†’ 0.14, cluster votes: 3/3)
   âš ï¸  PoA Detection: v48 flagged as malicious (trust: 0.20 â†’ 0.14, cluster votes: 5/5)
   âš ï¸  PoA Detection: v56 flagged as malicious (trust: 0.20 â†’ 0.14, cluster votes: 7/7)
   âš ï¸  PoA Detection: v80 flagged as malicious (trust: 0.20 â†’ 0.14, cluster votes: 6/6)
   âš ï¸  PoA Detection: v88 flagged as malicious (trust: 0.20 â†’ 0.14, cluster votes: 7/7)
   âš ï¸  PoA Detection: v96 flagged as malicious (trust: 0.20 â†’ 0.14, cluster votes: 2/2)
   âš ï¸  PoA Detection: v104 flagged as malicious (trust: 0.20 â†’ 0.14, cluster votes: 2/2)
   âš ï¸  PoA Detection: v112 flagged as malicious (trust: 0.20 â†’ 0.14, cluster votes: 7/7)
   âš ï¸  PoA Detection: v120 flagged as malicious (trust: 0.20 â†’ 0.14, cluster votes: 3/3)
   âš ï¸  PoA Detection: v128 flagged as malicious (trust: 0.20 â†’ 0.14, cluster votes: 1/1)
   âš ï¸  PoA Detection: v144 flagged as malicious (trust: 0.20 â†’ 0.14, cluster votes: 6/6)
Progress: 0.0% - Time: 0.0s - Clusters: 0 - Raft: follower
Progress: 4.2% - Time: 5.0s - Clusters: 0 - Raft: follower
Progress: 8.3% - Time: 10.0s - Clusters: 17 - Raft: follower
   ğŸ“Š Trust Update (v0): Historical=0.934, Social=1.000 â†’ New Trust=0.967
   ğŸ“Š Trust Update (v1): Historical=0.967, Social=1.000 â†’ New Trust=0.983
   ğŸ“Š Trust Update (v2): Historical=0.965, Social=1.000 â†’ New Trust=0.982
Progress: 12.5% - Time: 15.0s - Clusters: 16 - Raft: follower
Progress: 16.7% - Time: 20.0s - Clusters: 16 - Raft: follower
   ğŸ“Š Trust Update (v0): Historical=0.923, Social=1.000 â†’ New Trust=0.961
   ğŸ“Š Trust Update (v1): Historical=0.956, Social=1.000 â†’ New Trust=0.978
   ğŸ“Š Trust Update (v2): Historical=0.954, Social=1.000 â†’ New Trust=0.977
Progress: 20.8% - Time: 25.0s - Clusters: 15 - Raft: follower
   ğŸ”—  Merged 1 overlapping clusters into cluster_1
   ğŸ”—  Merged 1 overlapping clusters into cluster_7
   ğŸ”—  Merged 1 overlapping clusters into cluster_10
   ğŸ”·  Boundary nodes elected in cluster_0: 2 boundary nodes for 2 neighboring clusters
   ğŸ”·  Boundary nodes elected in cluster_6: 1 boundary nodes for 1 neighboring clusters
   ğŸ”·  Boundary nodes elected in cluster_7: 1 boundary nodes for 1 neighboring clusters
   ğŸ”·  Boundary nodes elected in cluster_25: 1 boundary nodes for 1 neighboring clusters
   ğŸ”·  Boundary nodes elected in cluster_15: 1 boundary nodes for 1 neighboring clusters
   âš ï¸  PoA Detection: v8 flagged as malicious (trust: 0.65 â†’ 0.45, cluster votes: 2/2)
Progress: 25.0% - Time: 30.0s - Clusters: 14 - Raft: follower
   ğŸ“Š Trust Update (v0): Historical=0.917, Social=1.000 â†’ New Trust=0.959
   ğŸ“Š Trust Update (v1): Historical=0.950, Social=1.000 â†’ New Trust=0.975
   ğŸ“Š Trust Update (v2): Historical=0.949, Social=1.000 â†’ New Trust=0.975
   âš ï¸  Leader failure in cluster_0: v139 (out of range)
   ğŸ‘”  Co-leader elected: v97 in cluster_0 (score: 0.827)
   âœ…  Co-leader succession: v97 â†’ Leader in cluster_0
   âš ï¸  Leader failure in cluster_1: v139 (out of range)
   ğŸ“¡  Relay nodes elected in cluster_1: 5 relays for 22 out-of-range members
   ğŸ‘”  Co-leader elected: v140 in cluster_1 (score: 0.930)
   âœ…  Co-leader succession: v140 â†’ Leader in cluster_1
   âš ï¸  Leader failure in cluster_3: v55 (out of range)
   ğŸ‘”  Co-leader elected: v36 in cluster_3 (score: 0.857)
   âœ…  Co-leader succession: v36 â†’ Leader in cluster_3
   âš ï¸  Leader failure in cluster_4: v107 (out of range)
   ğŸ‘”  Co-leader elected: v125 in cluster_4 (score: 0.840)
   âœ…  Co-leader succession: v125 â†’ Leader in cluster_4
   âš ï¸  Leader failure in cluster_17: v59 (out of range)
   ğŸ‘”  Co-leader elected: v49 in cluster_17 (score: 0.764)
   âœ…  Co-leader succession: v49 â†’ Leader in cluster_17
   ğŸ“¡  Relay nodes elected in cluster_15: 2 relays for 2 out-of-range members
   ğŸ‘”  Co-leader elected: v57 in cluster_15 (score: 0.714)
   ğŸ‘”  Co-leader elected: v140 in cluster_14 (score: 0.761)
   âš ï¸  Leader failure in cluster_3: v148 (out of range)
   ğŸ‘”  Co-leader elected: v79 in cluster_3 (score: 0.829)
   âœ…  Co-leader succession: v79 â†’ Leader in cluster_3
   âš ï¸  Leader failure in cluster_17: v149 (out of range)
   ğŸ‘”  Co-leader elected: v134 in cluster_17 (score: 0.750)
   âœ…  Co-leader succession: v134 â†’ Leader in cluster_17
Progress: 29.2% - Time: 35.0s - Clusters: 11 - Raft: follower
Progress: 33.3% - Time: 40.0s - Clusters: 11 - Raft: follower
Progress: 37.5% - Time: 45.0s - Clusters: 11 - Raft: follower
Progress: 41.7% - Time: 50.0s - Clusters: 10 - Raft: follower
Progress: 45.8% - Time: 55.0s - Clusters: 8 - Raft: follower
   ğŸ—³ï¸  Cluster cluster_10: Elected v75 via majority consensus
      ğŸ“Š 5-METRIC BREAKDOWN:
         â€¢ Trust (40%):      0.996
         â€¢ Resource (20%):   0.836
         â€¢ Stability (15%):  0.000
         â€¢ Behavior (15%):   1.000
         â€¢ Centrality (10%): 0.379
      âœ  COMPOSITE SCORE: 0.753 | Votes: 100.0%
      âœ“  Formula: 0.40Ã—0.996 + 0.20Ã—0.836 + 0.15Ã—0.000 + 0.15Ã—1.000 + 0.10Ã—0.379 = 0.753
   ğŸ”—  Merged 2 overlapping clusters into cluster_0
   ğŸ”—  Merged 1 overlapping clusters into cluster_17
   âš ï¸  Leader failure in cluster_0: v75 (out of range)
   ğŸ‘”  Co-leader elected: v75 in cluster_0 (score: 0.850)
   âœ…  Co-leader succession: v75 â†’ Leader in cluster_0
Progress: 50.0% - Time: 60.0s - Clusters: 8 - Raft: follower
   âš ï¸  Leader failure in cluster_0: v60 (out of range)
   ğŸ‘”  Co-leader elected: v31 in cluster_0 (score: 0.841)
   âœ…  Co-leader succession: v31 â†’ Leader in cluster_0
   âš ï¸  Leader failure in cluster_0: v75 (out of range)
   ğŸ“¡  Relay nodes elected in cluster_0: 3 relays for 43 out-of-range members
   ğŸ‘”  Co-leader elected: v75 in cluster_0 (score: 0.842)
   âœ…  Co-leader succession: v75 â†’ Leader in cluster_0
   âš ï¸  Leader failure in cluster_3: v145 (out of range)
   ğŸ‘”  Co-leader elected: v138 in cluster_3 (score: 0.927)
   âœ…  Co-leader succession: v138 â†’ Leader in cluster_3
   ğŸ‘”  Co-leader elected: v138 in cluster_7 (score: 0.773)
   âš ï¸  Leader failure in cluster_3: v79 (out of range)
   ğŸ“¡  Relay nodes elected in cluster_3: 2 relays for 15 out-of-range members
   ğŸ‘”  Co-leader elected: v10 in cluster_3 (score: 0.910)
   âœ…  Co-leader succession: v10 â†’ Leader in cluster_3
Progress: 54.2% - Time: 65.0s - Clusters: 6 - Raft: follower
Progress: 58.3% - Time: 70.0s - Clusters: 5 - Raft: follower
Progress: 62.5% - Time: 75.0s - Clusters: 5 - Raft: follower
Progress: 66.7% - Time: 80.0s - Clusters: 5 - Raft: follower
Progress: 70.8% - Time: 85.0s - Clusters: 4 - Raft: follower
Progress: 75.0% - Time: 90.0s - Clusters: 3 - Raft: follower
Progress: 79.2% - Time: 95.0s - Clusters: 4 - Raft: follower
Progress: 83.3% - Time: 100.0s - Clusters: 4 - Raft: follower
Progress: 87.5% - Time: 105.0s - Clusters: 4 - Raft: follower
Progress: 91.7% - Time: 110.0s - Clusters: 4 - Raft: follower
Progress: 95.8% - Time: 115.0s - Clusters: 4 - Raft: follower
Progress: 100.0% - Time: 120.0s - Clusters: 3 - Raft: follower
Simulation complete! Captured 241 frames

======================================================================
ğŸ—³ï¸  CONSENSUS-BASED CLUSTER HEAD ELECTION STATISTICS
======================================================================
Algorithm: Hybrid (Raft + PoA)
Total head elections: 361
Malicious nodes detected (PoA): 17
Trust updates: 11

ğŸ“Š Raft Consensus:
   State: follower
   Current term: 0
   Cluster nodes: 150

ğŸ›¡ï¸  Proof of Authority (PoA):
   Active authorities: 133
   Authority threshold: 0.8 trust score

ğŸ“ˆ Trust Distribution:
   Average trust score: 0.916
   High trust nodes (>0.7): 133
   Medium trust (0.4-0.7): 14
   Low trust nodes (<0.4): 3

ğŸš¨ Security:
   Known malicious: 17
   Flagged by PoA: 17
   Detection rate: 100.0%

ğŸ“¡ V2V Communication:
   Total messages: 10841
   Collision warnings: 3196
   Lane change alerts: 1980
   Emergency alerts: 1932
   Brake warnings: 1077
   Traffic jam alerts: 2656
   Communication range: 250 pixels

ğŸ” Multi-Hop Relay System:
   Total relay nodes: 3
   Relayed messages: 451
   Relay hops: 788
   Average hops per relayed message: 1.75

ğŸ”· Inter-Cluster Boundary Nodes:
   Total boundary nodes: 0
   Clusters with boundary nodes: 0
   Inter-cluster messages: 12
======================================================================

âœ… Animation data exported to: city_animation_data.json
ğŸ“Š Total frames: 241
â±ï¸  Duration: 120s
ğŸš¦ Intersections: 97
ğŸ›£ï¸  Roads: 350

âœ… HTML file will be: city_traffic_animation.html

âœ… Done! Now open city_traffic_animation.html to see Times Square traffic!
